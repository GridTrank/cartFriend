{"version":3,"sources":["uni-app:///main.js","webpack:///D:/work/cartFriend/pages/Chat/Chat.vue?a1c2","webpack:///D:/work/cartFriend/pages/Chat/Chat.vue?ce73","webpack:///D:/work/cartFriend/pages/Chat/Chat.vue?a65f","webpack:///D:/work/cartFriend/pages/Chat/Chat.vue?d836","uni-app:///pages/Chat/Chat.vue","webpack:///D:/work/cartFriend/pages/Chat/Chat.vue?c07f","webpack:///D:/work/cartFriend/pages/Chat/Chat.vue?b7bb"],"names":["createPage","Page"],"mappings":"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A;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAFA;AAGA,WANA;AAOA,SAVA,MAUA;AACA;AACA;AACA,+CADA,CACA;AACA;AACA,0CADA,CACA;AACA,aAFA;AAGA,WALA;AAMA;AACA;AACA;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA,OAtCA;AAuCA,KAzHA;AA0HA,eA1HA,qMA0HA;AACA;AACA,+BADA;AAEA,mCAFA;AAGA,UAHA,CAGA;AACA;AACA;AACA,2BADA;AAEA,qCAFA;AAGA,uCAHA;AAIA,2BAJA;AAKA,sCALA;AAMA,oBANA;;AAQA;AACA,yCADA;;AAGA;AACA,OAjBA;AAkBA,KA7IA;;AA+IA,aA/IA,qBA+IA,GA/IA,EA+IA,IA/IA,EA+IA;AACA;AACA,OADA,MACA;AACA;AACA;AACA;AACA;AACA,kBADA;AAEA,iCAFA;AAGA,iCAHA;AAIA,oBAJA;AAKA,kCALA;AAMA,gBANA;;;AASA;AACA,qCADA;;AAGA,KAjKA;AAkKA;AACA,YAnKA,sBAmKA;AACA,wBADA,CACA;AACA;AACA;AACA;AACA;AACA,wBANA,CAMA;AACA,KA1KA;;AA4KA;AACA,YA7KA,sBA6KA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA,KAtLA;AAuLA;AACA,cAxLA,wBAwLA;AACA;AACA,KA1LA;AA2LA;AACA,cA5LA,wBA4LA;AACA;AACA;AACA;AACA;AACA,OAHA,EAGA,GAHA;AAIA,KAlMA;AAmMA;AACA,eApMA,yBAoMA;AACA;AACA,KAtMA;AAuMA;AACA,UAxMA,oBAwMA;AACA;AACA,KA1MA;AA2MA;AACA,YA5MA,oBA4MA,IA5MA,EA4MA;AACA;AACA;AACA;AACA,4BADA;AAEA,kBAFA;AAGA;AACA;AACA;;;;;;;;;;AAUA;AACA,uBADA;AAEA,qBAFA,mBAEA,IAFA,EAEA;AACA;AACA,gCADA;AAEA,uEAFA;;AAIA;AACA,eARA;AASA,kBATA,gBASA,GATA,EASA;AACA;AACA,eAXA;;;AAcA,WA7BA;AA8BA;AACA;AACA,WAhCA;;AAkCA,OAnCA;AAoCA,UApCA,CAoCA;AACA;AACA,2BADA;;AAGA;AACA,eADA;AAEA,0BAFA,4BAEA,CAFA,EAEA;AACA;AACA,WAJA;;AAMA,OA9CA;AA+CA,UA/CA,CA+CA;AACA;AACA;AACA;AACA;AACA,gCADA;AAEA;AACA;AACA,8CADA;AAEA;AACA;AACA;AACA;AACA;AACA,eAPA;;AASA,WAZA;AAaA;AACA;AACA,iCADA;AAEA,+BAFA;;AAIA,WAlBA;;AAoBA,OAvEA;AAwEA,WAxEA,CAwEA;AACA;AACA;AACA;AACA;AACA,2DADA;AAEA,6BAFA;;AAIA;AACA,OAjFA;AAkFA,KAhSA;AAiSA;AACA,eAlSA,yBAkSA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA,KA1SA;AA2SA;AACA,YA5SA,oBA4SA,EA5SA,EA4SA;AACA;AACA,KA9SA;;;;AAkTA;AACA,WAnTA,mBAmTA,GAnTA,EAmTA;AACA;AACA,yBADA;AAEA,gCAFA;AAGA,6BAHA;;AAKA,KAzTA;AA0TA;AACA,aA3TA,qBA2TA,GA3TA,EA2TA;AACA;AACA;AACA;AACA;AACA,OAFA;AAGA,KAjUA;AAkUA;AACA,cAnUA,sBAmUA,CAnUA,EAmUA;AACA;AACA;AACA;AACA;AACA;AACA,6CANA,CAMA;AACA,KA1UA;AA2UA;AACA,eA5UA,uBA4UA,CA5UA,EA4UA;AACA;AACA;AACA;AACA;AACA;AACA,OAFA,EAEA,IAFA;AAGA,KAnVA;AAoVA;AACA,eArVA,yBAqVA;AACA;AACA;AACA;AACA,2BAJA,CAIA;AACA,2BALA,CAKA;AACA,KA3VA;AA4VA;AACA,YA7VA,oBA6VA,CA7VA,EA6VA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA,KA1WA;AA2WA;AACA,YA5WA,oBA4WA,CA5WA,EA4WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAPA,CAOA;AACA,KApXA;AAqXA;AACA,aAtXA,qBAsXA,CAtXA,EAsXA;AACA;AACA;AACA;AACA;AACA,mBADA;AAEA,6BAFA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA,kBADA,CACA;AACA,kCADA;AAEA,wCAFA;AAGA,0BAHA,4BAGA,CAHA,EAGA;AACA;AACA,WALA,EADA;;AAQA,YARA,CAQA;AACA;AACA,kCADA;AAEA;AACA;AACA;AACA,aALA;AAMA;AACA;AACA,qCADA;AAEA,iCAFA;;AAIA,aAXA;;AAaA,SAtBA;AAuBA,aAvBA,CAuBA;AACA;AACA;AACA;AACA,2HADA;AAEA,+BAFA;;AAIA;AACA,SA/BA;AAgCA,OA3CA,MA2CA;AACA;AACA;AACA;AACA,KAvaA;AAwaA;AACA,eAzaA,yBAyaA;AACA;AACA;AACA,KA5aA,EAxGA,E;;;;;;;;;;;;;ACrJA;AAAA;AAAA;AAAA;AAA6uC,CAAgB,kpCAAG,EAAC,C;;;;;;;;;;;ACAjwC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/Chat/Chat.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/Chat/Chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./Chat.vue?vue&type=template&id=5823bff4&\"\nvar renderjs\nimport script from \"./Chat.vue?vue&type=script&lang=js&\"\nexport * from \"./Chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Chat.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/Chat/Chat.vue\"\nexport default component.exports","export * from \"-!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Chat.vue?vue&type=template&id=5823bff4&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.messageList, function(row, index) {\n    var $orig = _vm.__get_orig(row)\n\n    var m0 = row.userId === _vm.user.id ? _vm.replaceEmoji(row.content) : null\n    var m1 = !(row.userId === _vm.user.id)\n      ? _vm.replaceEmoji(row.content)\n      : null\n    return {\n      $orig: $orig,\n      m0: m0,\n      m1: m1\n    }\n  })\n\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      $event.stopPropagation()\n      $event.preventDefault()\n      return null($event)\n    }\n  }\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Chat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"content\" @click.stop=\"hideDrawer\">\r\n\t\t\t<scroll-view\r\n\t\t\t\tclass=\"msg-list\"\r\n\t\t\t\tscroll-y=\"true\"\r\n\t\t\t\t:scroll-with-animation=\"scrollAnimation\"\r\n\t\t\t\t:scroll-top=\"scrollTop\"\r\n\t\t\t\t:scroll-into-view=\"scrollToView\"\r\n\t\t\t\t@scrolltoupper=\"loadHistory\"\r\n\t\t\t\tupper-threshold=\"50\"\r\n\t\t\t\t:class=\"popupLayerClass\"\r\n\t\t\t\t:style=\"'bottom:'+(inputHight+50) +'px'\"\r\n\t\t\t>\r\n\t\t\t\t<!-- 加载历史数据waitingUI -->\r\n\t\t\t\t<view class=\"loading\" v-if=\"showLoading\">\r\n\t\t\t\t\t<view class=\"spinner\">\r\n\t\t\t\t\t\t<view class=\"rect1\"></view>\r\n\t\t\t\t\t\t<view class=\"rect2\"></view>\r\n\t\t\t\t\t\t<view class=\"rect3\"></view>\r\n\t\t\t\t\t\t<view class=\"rect4\"></view>\r\n\t\t\t\t\t\t<view class=\"rect5\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"row\" v-for=\"(row, index) in messageList\" :key=\"index\" :id=\"'msg' + row.id\">\r\n\t\t\t\t\t<!-- 系统消息 -->\r\n\t\t\t\t\t<!-- <block v-if=\"row.type == 'system'\">\r\n\t\t\t\t\t\t<view class=\"system\">\r\n\t\t\t\t\t\t\t<view v-if=\"row.content.type == 'text'\" class=\"text\">{{ row.content }}</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</block> -->\r\n\t\t\t\t\t<!-- 用户消息 -->\r\n\t\t\t\t\t<!-- 自己发出的消息 -->\r\n\t\t\t\t\t<view class=\"my\" v-if=\"row.userId === user.id\">\r\n\t\t\t\t\t\t<!-- 左-消息 -->\r\n\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t<!--  v-if=\"row.type == 'text'\" -->\r\n\t\t\t\t\t\t\t<view class=\"bubble\">\r\n\t\t\t\t\t\t\t\t<rich-text :nodes=\"replaceEmoji(row.content)\"></rich-text>\r\n\t\t\t\t\t\t\t\t<!-- {{row.content}} -->\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 语言消息 -->\r\n\t\t\t\t\t\t\t<!-- <view v-if=\"row.type == 'voice'\" class=\"bubble voice\" @tap=\"playVoice(row)\" :class=\"playMsgid == row.id ? 'play' : ''\">\r\n\t\t\t\t\t\t\t\t<view class=\"length\">{{ row.content.length }}</view>\r\n\t\t\t\t\t\t\t\t<view class=\"icon my-voice\"></view>\r\n\t\t\t\t\t\t\t</view> -->\r\n\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t<!-- <view v-if=\"row.type == 'img'\" class=\"bubble img\" @tap=\"showPic(row)\">\r\n\t\t\t\t\t\t\t\t<image :src=\"row.content.url\" :style=\"{ width: row.content.w + 'px', height: row.content.h + 'px' }\"></image>\r\n\t\t\t\t\t\t\t</view> -->\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- 右-头像 -->\r\n\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t<image :src=\"user.photo\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- 别人发出的消息 -->\r\n\t\t\t\t\t<view class=\"other\" v-else>\r\n\t\t\t\t\t\t<!-- 左-头像 -->\r\n\t\t\t\t\t\t<view class=\"left\"><image :src=\"toUser.photo\"></image></view>\r\n\t\t\t\t\t\t\t<!-- 右-用户名称-时间-消息 -->\r\n\t\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t\t<view class=\"username\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"name\">{{ toUser.nickName }}</view>\r\n\t\t\t\t\t\t\t\t\t<!-- <view class=\"time\">{{ latelyDate(row.time) }}</view> -->\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t<view class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"replaceEmoji(row.content)\"></rich-text>\r\n\t\t\t\t\t\t\t\t\t<!-- {{row.content}} -->\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 语音消息 -->\r\n\t\t\t\t\t\t\t\t<!-- <view v-if=\"row.type == 'voice'\" class=\"bubble voice\" @tap=\"playVoice(row)\" :class=\"playMsgid == row.id ? 'play' : ''\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"icon other-voice\"></view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"length\">{{ row.content.length }}</view>\r\n\t\t\t\t\t\t\t\t</view> -->\r\n\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t<!-- <view v-if=\"row.type == 'img'\" class=\"bubble img\" @tap=\"showPic(row)\">\r\n\t\t\t\t\t\t\t\t\t<image :src=\"row.content.url\" :style=\"{ width: row.content.w + 'px', height: row.content.h + 'px' }\"></image>\r\n\t\t\t\t\t\t\t\t</view> -->\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\t\t<!-- 抽屉栏 -->\r\n\t\t<view class=\"popup-layer\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"null\">\r\n\t\t\t<!-- 表情 -->\r\n\t\t\t<swiper class=\"emoji-swiper\" :class=\"{ hidden: hideEmoji }\" indicator-dots=\"true\" duration=\"150\">\r\n\t\t\t\t<swiper-item v-for=\"(page, pid) in emojiList\" :key=\"pid\">\r\n\t\t\t\t\t<view v-for=\"(em, eid) in page\" :key=\"eid\" @tap=\"addEmoji(em)\">\r\n\t\t\t\t\t\t<image mode=\"widthFix\" :src=\"'/static/img/emoji/' + em.url\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t</swiper-item>\r\n\t\t\t</swiper>\r\n\t\t\t<!-- 更多功能 相册-拍照-红包 -->\r\n\t\t\t<view class=\"more-layer\" :class=\"{ hidden: hideMore }\">\r\n\t\t\t\t<view class=\"list\">\r\n\t\t\t\t\t<view class=\"box\" @tap=\"chooseImage\"><view class=\"icon tupian2\"></view></view>\r\n\t\t\t\t\t<view class=\"box\" @tap=\"camera\"><view class=\"icon paizhao\"></view></view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 底部输入栏  @touchmove.stop.prevent=\"discard\"-->\r\n\t\t<view class=\"input-box\" :class=\"popupLayerClass\" :style=\"[{ 'margin-bottom': inputHight + 'px' }]\">\r\n\t\t\t<!-- H5下不能录音，输入栏布局改动一下 -->\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<!-- <view class=\"voice\"><view class=\"icon\" :class=\"isVoice ? 'jianpan' : 'yuyin'\" @tap=\"switchVoice\"></view></view> -->\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<!-- #ifdef H5 -->\r\n\t\t\t<!-- <view class=\"more\" @tap=\"showMore\"><view class=\"icon add\"></view></view> -->\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"textbox\">\r\n\t\t\t\t<view\r\n\t\t\t\t\tclass=\"voice-mode\"\r\n\t\t\t\t\t:class=\"[isVoice ? '' : 'hidden', recording ? 'recording' : '']\"\r\n\t\t\t\t\t@touchstart=\"voiceBegin\"\r\n\t\t\t\t\t@touchmove.stop.prevent=\"voiceIng\"\r\n\t\t\t\t\t@touchend=\"voiceEnd\"\r\n\t\t\t\t\t@touchcancel=\"voiceCancel\"\r\n\t\t\t\t>\r\n\t\t\t\t\t{{ voiceTis }}\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"text-mode\" :class=\"isVoice ? 'hidden' : ''\">\r\n\t\t\t\t\t<view class=\"box\">\r\n\t\t\t\t\t\t<textarea auto-height=\"true\" :adjust-position=\"false\" v-model=\"textMsg\" @focus=\"textareaFocus\" @blur=\"textareaBlur\" /></view>\r\n\t\t\t\t\t<view class=\"em\" @tap=\"chooseEmoji\"><view class=\"icon biaoqing\"></view></view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<!-- <view class=\"more\" @tap=\"showMore\"><view class=\"icon add\"></view></view> -->\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"send\" :class=\"isVoice ? 'hidden' : ''\" @click.stop=\"sendMsg\"><view class=\"btn\">发送</view></view>\r\n\t\t</view>\r\n\t\t<!-- 录音UI效果 -->\r\n\t\t<view class=\"record\" :class=\"recording ? '' : 'hidden'\">\r\n\t\t\t<view class=\"ing\" :class=\"willStop ? 'hidden' : ''\"><view class=\"icon luyin2\"></view></view>\r\n\t\t\t<view class=\"cancel\" :class=\"willStop ? '' : 'hidden'\"><view class=\"icon chehui\"></view></view>\r\n\t\t\t<view class=\"tis\" :class=\"willStop ? 'change' : ''\">{{ recordTis }}</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script>\r\nimport { mapState } from 'vuex';\r\nimport emoji_List from '@/common/emojiList.js';\r\nimport online_Emoji from '@/common/onlineEmoji.js';\r\nimport { latelyDate, replaceEmoji, setPicSize, newDate } from '@/utils/util.js';\r\n\r\nexport default {\r\n\tcomputed: mapState([ 'currentMsg']),\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tuser:uni.getStorageInfo('userInfo'),\r\n\t\t\tsize:10,\r\n\t\t\tcurrent:1,\r\n\t\t\tmemberId:'',\r\n\t\t\tmessageList:[],\r\n\t\t\tisContinue:true,\r\n\t\t\tshowLoading:false,\r\n\t\t\tcontent:'',\r\n\t\t\t//文字消息\r\n\t\t\ttextMsg: '',\r\n\t\t\ttoUser: null,\r\n\t\t\tmsgList: [],\r\n\t\t\tpage: {\r\n\t\t\t\tpageNo: 0,\r\n\t\t\t\tpageSize: 10,\r\n\t\t\t\tend: false,\r\n\t\t\t\tisHistoryLoading: false\r\n\t\t\t},\r\n\t\t\tinputHight: null,\r\n\t\t\tlatelyDate: latelyDate,\r\n\t\t\treplaceEmoji: replaceEmoji,\r\n\t\t\t\r\n\t\t\t//消息列表\r\n\r\n\t\t\tscrollAnimation: false,\r\n\t\t\tscrollTop: 0,\r\n\t\t\tscrollToView: '',\r\n\t\t\tmsgImgList: [],\r\n\t\t\t//录音相关参数\r\n\t\t\t// #ifndef H5\r\n\t\t\t//H5不能录音\r\n\t\t\tRECORDER: uni.getRecorderManager(),\r\n\t\t\t// #endif\r\n\t\t\tisVoice: false,\r\n\t\t\tvoiceTis: '按住 说话',\r\n\t\t\trecordTis: '手指上滑 取消发送',\r\n\t\t\trecording: false,\r\n\t\t\twillStop: false,\r\n\t\t\tinitPoint: { identifier: 0, Y: 0 },\r\n\t\t\trecordTimer: null,\r\n\t\t\trecordLength: 0,\r\n\t\t\t//播放语音相关参数\r\n\t\t\tAUDIO: uni.createInnerAudioContext(),\r\n\t\t\tplayMsgid: null,\r\n\t\t\tVoiceTimer: null,\r\n\t\t\t// 抽屉参数\r\n\t\t\tpopupLayerClass: '',\r\n\t\t\t// more参数\r\n\t\t\thideMore: true,\r\n\t\t\t//表情定义\r\n\t\t\thideEmoji: true,\r\n\t\t\temojiList: emoji_List\r\n\t\t};\r\n\t},\r\n\tonLoad(option) {\r\n\t\tuni.onKeyboardHeightChange(res => {\r\n\t\t\tthis.inputHight = res.height;\r\n\t\t});\r\n\t\tthis.toUser =option.user? JSON.parse(option.user) :{};\r\n\t\tthis.memberId=this.toUser.userId\r\n\t\tuni.setNavigationBarTitle({\r\n\t\t\ttitle: this.toUser.nickName\r\n\t\t});\r\n\t\t/*  暂时不用  */\r\n\t\treturn\r\n\t\tthis.loadHistory();\r\n\t\t//语音自然播放结束\r\n\t\tthis.AUDIO.onEnded(res => {\r\n\t\t\tthis.playMsgid = null;\r\n\t\t});\r\n\t\t// #ifndef H5\r\n\t\t//录音开始事件\r\n\t\tthis.RECORDER.onStart(e => {\r\n\t\t\tthis.recordBegin(e);\r\n\t\t});\r\n\t\t//录音结束事件\r\n\t\tthis.RECORDER.onStop(e => {\r\n\t\t\tthis.recordEnd(e);\r\n\t\t});\r\n\t\t// #endif\r\n\t},\r\n\tonShow() {\r\n\t\tthis.user=uni.getStorageSync('userInfo')\r\n\t\tthis.getMessageList()\r\n\r\n\t},\r\n\twatch: {\r\n\t\tcurrentMsg: {\r\n\t\t\tdeep: true,\r\n\t\t\thandler(newMsg) {\r\n\t\t\t\tif ((newMsg.to_userId == this.toUser.id && newMsg.from_userId == this.user.id) || (newMsg.to_userId == this.user.id && newMsg.from_userId == this.toUser.id)) {\r\n\t\t\t\t\tthis.msgList.push(newMsg);\r\n\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t// 滚动到底\r\n\t\t\t\t\t\tthis.scrollToView = 'msg' + newMsg.id;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tgetMessageList(){\r\n\t\t\tlet data={\r\n\t\t\t\tsize:this.size,\r\n\t\t\t\tcurrent:this.current,\r\n\t\t\t\tmemberId:this.memberId,\r\n\t\t\t}\r\n\t\t\tthis.$http({url:'/member/letterDialog',data}).then(res=>{\r\n\t\t\t\tif(res.data.records.length>=this.size ){\r\n\t\t\t\t\tthis.isContinue=true\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.isContinue=false\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tres.data.records.forEach(item=>{\r\n\t\t\t\t\tthis.messageList.unshift(item)\r\n\t\t\t\t})\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tthis.showLoading = false;\r\n\t\t\t\t\tthis.scrollAnimation = false;\r\n\t\t\t\t},1000)\r\n\t\t\t\t\r\n\t\t\t})\r\n\t\t\t\r\n\t\t},\r\n\t\tsendMsg(){\r\n\t\t\tif(!this.textMsg)return\r\n\t\t\tlet data={\r\n\t\t\t\tcontent:this.textMsg,\r\n\t\t\t\tmemberId:this.memberId,\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.$http({url:'/member/letter',data,method:'POST'}).then(res=>{\r\n\t\t\t\tif(res.code!=200){\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle:res.msg,\r\n\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tlet message = {\r\n\t\t\t\t\tmemberId: this.toUser.userId,\r\n\t\t\t\t\tuserId: this.user.id,\r\n\t\t\t\t\tcontent: this.textMsg,\r\n\t\t\t\t};\r\n\t\t\t\tthis.messageList.push(message)\r\n\t\t\t\tthis.scrollTop = 1000*this.messageList.length;\r\n\t\t\t\t// this.getMessageList()\r\n\t\t\t\tthis.textMsg='' \r\n\t\t\t})\r\n\t\t},\r\n\t\t//获取焦点，如果不是选表情ing,则关闭抽屉\r\n\t\ttextareaFocus(e) {\r\n\t\t\tif (this.popupLayerClass == 'showLayer' && this.hideMore == false) {\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t}\r\n\t\t\tthis.scrollTop = 1000*this.messageList.length;\r\n\t\t\tconsole.log(this.inputHight)\r\n\t\t},\r\n\t\ttextareaBlur(){\r\n\t\t\tthis.popupLayerClass=''\r\n\t\t},\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t/*---------------------------------------暂时不用----------------------------------------------------*/\r\n\t\t//触发滑动到顶部(加载历史信息记录)\r\n\t\tloadHistory() {\r\n\t\t\tconsole.log(1111111111)\r\n\t\t\tif (this.isContinue) {\r\n\t\t\t\tthis.showLoading=true\r\n\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\tthis.current++\r\n\t\t\t\tthis.getMessageList()\r\n\t\t\t}\r\n\t\t\treturn\r\n\t\t\tthis.page.isHistoryLoading = true; //参数作为进入请求标识，防止重复请求\r\n\t\t\tthis.scrollAnimation = true; //关闭滑动动画\r\n\t\t\tthis.current++\r\n\t\t\tthis.getMessageList()\r\n\t\t\t\r\n\t\t\tlet viewId = this.msgList.length > 0 ? this.msgList[0].id : 0; //记住第一个信息ID\r\n\t\t\tgetMsgList({\r\n\t\t\t\tuserId: this.user.id,\r\n\t\t\t\ttoUserId: this.toUser.id,\r\n\t\t\t\tpageNo: this.page.pageNo,\r\n\t\t\t\tpageSize: this.page.pageSize\r\n\t\t\t}).then(list => {\r\n\t\t\t\tfor (let i = 0; i < list.length; i++) {\r\n\t\t\t\t\tif (list[i].type == 'img') {\r\n\t\t\t\t\t\tlist[i].content = setPicSize(list[i].content);\r\n\t\t\t\t\t\tthis.msgImgList.push(list[i].content.url);\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tif (this.page.pageNo === 0) {\r\n\t\t\t\t\tthis.msgList=list;\r\n\t\t\t\t\t// 滚动到底部\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\t\tthis.scrollTop = 9999;\r\n\t\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.msgList.unshift(...list);\r\n\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\tthis.scrollToView = 'msg' + viewId; //跳转上次的第一行信息位置\r\n\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\tthis.scrollAnimation = true; //恢复滚动动画\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (list.length === this.page.pageSize) {\r\n\t\t\t\t\tthis.page.pageNo++;\r\n\t\t\t\t\tthis.page.isHistoryLoading = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.page.end = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tsetHaveRead() {\r\n\t\t\tsetHaveRead({\r\n\t\t\t\tto_userId: this.user.id,\r\n\t\t\t\tfrom_userId: this.toUser.id\r\n\t\t\t}).then(res => {\r\n\t\t\t\tif (res > 0) {\r\n\t\t\t\t\tlet message = {\r\n\t\t\t\t\t\ttype: 'reading',\r\n\t\t\t\t\t\tto_userId: this.user.id,\r\n\t\t\t\t\t\tfrom_userId: this.user.id,\r\n\t\t\t\t\t\tcontent: '已经阅读',\r\n\t\t\t\t\t\ttime: newDate(),\r\n\t\t\t\t\t\tstate: 1\r\n\t\t\t\t\t};\r\n\t\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\t\tdata: JSON.stringify(message)\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t\r\n\t\tscreenMsg(msg, type) {\r\n\t\t\tif (type == 'voice') {\r\n\t\t\t} else if (type == 'img') {\r\n\t\t\t\tmsg = setPicSize(msg);\r\n\t\t\t\tthis.msgImgList.push(msg);\r\n\t\t\t}\r\n\t\t\tlet message = {\r\n\t\t\t\ttype: type,\r\n\t\t\t\tto_userId: this.toUser.id,\r\n\t\t\t\tfrom_userId: this.user.id,\r\n\t\t\t\tcontent: msg,\r\n\t\t\t\ttime: newDate(),\r\n\t\t\t\tstate: 1\r\n\t\t\t};\r\n\r\n\t\t\tuni.sendSocketMessage({\r\n\t\t\t\tdata: JSON.stringify(message)\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 发送文字消息\r\n\t\tsendText() {\r\n\t\t\tthis.hideDrawer(); //隐藏抽屉\r\n\t\t\tif (this.textMsg == '') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.screenMsg(this.textMsg, 'text');\r\n\t\t\tthis.textMsg = ''; //清空输入框\r\n\t\t},\r\n\r\n\t\t//更多功能(点击+弹出)\r\n\t\tshowMore() {\r\n\t\t\tthis.isVoice = false;\r\n\t\t\tthis.hideEmoji = true;\r\n\t\t\tif (this.hideMore) {\r\n\t\t\t\tthis.hideMore = false;\r\n\t\t\t\tthis.openDrawer();\r\n\t\t\t} else {\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 打开抽屉\r\n\t\topenDrawer() {\r\n\t\t\tthis.popupLayerClass = 'showLayer';\r\n\t\t},\r\n\t\t// 隐藏抽屉\r\n\t\thideDrawer() {\r\n\t\t\tthis.popupLayerClass = '';\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.hideMore = true;\r\n\t\t\t\tthis.hideEmoji = true;\r\n\t\t\t}, 150);\r\n\t\t},\r\n\t\t// 选择图片发送\r\n\t\tchooseImage() {\r\n\t\t\tthis.getImage('album');\r\n\t\t},\r\n\t\t//拍照发送\r\n\t\tcamera() {\r\n\t\t\tthis.getImage('camera');\r\n\t\t},\r\n\t\t//选照片 or 拍照\r\n\t\tgetImage(type) {\r\n\t\t\tthis.hideDrawer();\r\n\t\t\tnew Promise((resolve, reject) => {\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tsourceType: [type],\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tconst path = res.tempFilePaths[0];\r\n\t\t\t\t\t\tlet ext;\r\n\t\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\t\text = res.tempFiles[0].name.split('.').pop();\r\n\t\t\t\t\t\tconst options = {\r\n\t\t\t\t\t\t\tfilePath: path,\r\n\t\t\t\t\t\t\tcloudPath: Date.now() + '.' + ext\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tresolve(options);\r\n\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t// #ifndef H5\r\n\t\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\t\tsrc: path,\r\n\t\t\t\t\t\t\tsuccess(info) {\r\n\t\t\t\t\t\t\t\tconst options = {\r\n\t\t\t\t\t\t\t\t\tfilePath: path,\r\n\t\t\t\t\t\t\t\t\tcloudPath: Date.now() + '.' + info.type.toLowerCase()\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\tresolve(options);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\t\treject(new Error(err.errMsg || '未能获取图片类型'));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\treject(new Error('Fail_Cancel'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t\t.then(options => {\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\ttitle: '文件上传中...'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn uniCloud.uploadFile({\r\n\t\t\t\t\t\t...options,\r\n\t\t\t\t\t\tonUploadProgress(e) {\r\n\t\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t// 腾讯云需要获取临时链接\r\n\t\t\t\t\tuniCloud.getTempFileURL({\r\n\t\t\t\t\t\tfileList: [res.fileID],\r\n\t\t\t\t\t\tsuccess: ret => {\r\n\t\t\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\t\t\tsrc: ret.fileList[0].tempFileURL,\r\n\t\t\t\t\t\t\t\tsuccess: image => {\r\n\t\t\t\t\t\t\t\t\tconsole.log(image.width);\r\n\t\t\t\t\t\t\t\t\tconsole.log(image.height);\r\n\t\t\t\t\t\t\t\t\tlet msg = { url: ret.fileList[0].tempFileURL, w: image.width, h: image.height };\r\n\t\t\t\t\t\t\t\t\tthis.screenMsg(msg, 'img');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\tcontent: '获取临时链接失败',\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.catch(err => {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\tif (err.message !== 'Fail_Cancel') {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: `图片上传失败`,\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t},\r\n\t\t// 选择表情\r\n\t\tchooseEmoji() {\r\n\t\t\tthis.hideMore = true;\r\n\t\t\tif (this.hideEmoji) {\r\n\t\t\t\tthis.hideEmoji = false;\r\n\t\t\t\tthis.openDrawer();\r\n\t\t\t} else {\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t}\r\n\t\t},\r\n\t\t//添加表情\r\n\t\taddEmoji(em) {\r\n\t\t\tthis.textMsg += em.alt;\r\n\t\t},\r\n\r\n\t\t\r\n\t\t\r\n\t\t// 预览图片\r\n\t\tshowPic(msg) {\r\n\t\t\tuni.previewImage({\r\n\t\t\t\tindicator: 'none',\r\n\t\t\t\tcurrent: msg.content.url,\r\n\t\t\t\turls: this.msgImgList\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 播放语音\r\n\t\tplayVoice(msg) {\r\n\t\t\tthis.playMsgid = msg.id;\r\n\t\t\tthis.AUDIO.src = msg.content.url;\r\n\t\t\tthis.$nextTick(function() {\r\n\t\t\t\tthis.AUDIO.play();\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 录音开始\r\n\t\tvoiceBegin(e) {\r\n\t\t\tif (e.touches.length > 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.initPoint.Y = e.touches[0].clientY;\r\n\t\t\tthis.initPoint.identifier = e.touches[0].identifier;\r\n\t\t\tthis.RECORDER.start({ format: 'mp3' }); //录音开始,\r\n\t\t},\r\n\t\t//录音开始UI效果\r\n\t\trecordBegin(e) {\r\n\t\t\tthis.recording = true;\r\n\t\t\tthis.voiceTis = '松开 结束';\r\n\t\t\tthis.recordLength = 0;\r\n\t\t\tthis.recordTimer = setInterval(() => {\r\n\t\t\t\tthis.recordLength++;\r\n\t\t\t}, 1000);\r\n\t\t},\r\n\t\t// 录音被打断\r\n\t\tvoiceCancel() {\r\n\t\t\tthis.recording = false;\r\n\t\t\tthis.voiceTis = '按住 说话';\r\n\t\t\tthis.recordTis = '手指上滑 取消发送';\r\n\t\t\tthis.willStop = true; //不发送录音\r\n\t\t\tthis.RECORDER.stop(); //录音结束\r\n\t\t},\r\n\t\t// 录音中(判断是否触发上滑取消发送)\r\n\t\tvoiceIng(e) {\r\n\t\t\tif (!this.recording) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet touche = e.touches[0];\r\n\t\t\t//上滑一个导航栏的高度触发上滑取消发送\r\n\t\t\tif (this.initPoint.Y - touche.clientY >= uni.upx2px(100)) {\r\n\t\t\t\tthis.willStop = true;\r\n\t\t\t\tthis.recordTis = '松开手指 取消发送';\r\n\t\t\t} else {\r\n\t\t\t\tthis.willStop = false;\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送';\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 结束录音\r\n\t\tvoiceEnd(e) {\r\n\t\t\tif (!this.recording) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.recording = false;\r\n\t\t\tthis.voiceTis = '按住 说话';\r\n\t\t\tthis.recordTis = '手指上滑 取消发送';\r\n\t\t\tthis.RECORDER.stop(); //录音结束\r\n\t\t},\r\n\t\t//录音结束(回调文件)\r\n\t\trecordEnd(e) {\r\n\t\t\tclearInterval(this.recordTimer);\r\n\t\t\tif (!this.willStop) {\r\n\t\t\t\tconsole.log('e: ' + JSON.stringify(e));\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\tlength: 0,\r\n\t\t\t\t\turl: e.tempFilePath\r\n\t\t\t\t};\r\n\t\t\t\tlet min = parseInt(this.recordLength / 60);\r\n\t\t\t\tlet sec = this.recordLength % 60;\r\n\t\t\t\tmin = min < 10 ? '0' + min : min;\r\n\t\t\t\tsec = sec < 10 ? '0' + sec : sec;\r\n\t\t\t\tmsg.length = min + ':' + sec;\r\n\t\t\t\tuniCloud\r\n\t\t\t\t\t.uploadFile({\r\n\t\t\t\t\t\tfilePath: e.tempFilePath,\r\n\t\t\t\t\t\tcloudPath: Date.now() + '.mp3',\r\n\t\t\t\t\t\tonUploadProgress(e) {\r\n\t\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tuniCloud.getTempFileURL({\r\n\t\t\t\t\t\t\tfileList: [res.fileID],\r\n\t\t\t\t\t\t\tsuccess: result => {\r\n\t\t\t\t\t\t\t\tmsg.url = result.fileList[0].tempFileURL;\r\n\t\t\t\t\t\t\t\tthis.screenMsg(msg, 'voice');\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\tcontent: '获取语音临时链接失败',\r\n\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\tif (err.message !== 'Fail_Cancel') {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\tcontent: `语音上传失败，错误信息为：${err.message}`,\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('取消发送录音');\r\n\t\t\t}\r\n\t\t\tthis.willStop = false;\r\n\t\t},\r\n\t\t// 切换语音/文字输入\r\n\t\tswitchVoice() {\r\n\t\t\tthis.hideDrawer();\r\n\t\t\tthis.isVoice = this.isVoice ? false : true;\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n<style lang=\"scss\">\r\n@import '@/common/css/chat.scss';\r\n</style>\r\n","import mod from \"-!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Chat.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Chat.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1641214361791\n      var cssReload = require(\"D:/开发工具/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}